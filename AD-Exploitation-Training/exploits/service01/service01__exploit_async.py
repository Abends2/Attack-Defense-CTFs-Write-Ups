import asyncio 
import aiohttp 
import socket 
import json


async def fetch_data(url, session): 
	async with session.get(url) as response: 
		return await response.json(content_type=None)


async def main(): 
	# Список URL-ов для запросов 
	urls = [f"http://localhost:1100{i}/flags.json" for i in range(1, 6)]

	# Создаем сессию aiohttp 
	async with aiohttp.ClientSession() as session: 
		# Асинхронно получаем данные с двух сайтов 
		tasks = [fetch_data(url, session) for url in urls] 
		results = await asyncio.gather(*tasks) 

	# Если нужно посмотреть задержку сдачи флагов, то раскомментируйте строку ниже и запустите программу:
	# await asyncio.sleep(100)

	# Отправляем данные по сокету 
	with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s: 
		s.connect(('localhost', 1337)) 
		# print(results)
		for result in results: 
			print(f"[+] Flags: {result}")
			for flag in range(0, 4):
				enter_flag = result["flags"][flag]
				print("[+] Flag: ", enter_flag)
				s.send((enter_flag + "\n").encode('utf-8'))
				print(f"[+] Flagbot answer: {s.recv(1024)}")


# Запускаем асинхронный цикл 
asyncio.run(main())